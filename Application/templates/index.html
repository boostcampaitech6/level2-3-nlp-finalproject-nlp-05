<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script> -->
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="../static/css/style.css">
    <script src="../static/js/jquery_sakura.js"></script>
    <title>오늘의 시</title>

    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }

        #firstPage {
            display: block;
        }

        #secondPage {
            display: none; 
        }

        #thirdPage {
            display: none;
        }

    </style>
    <script>
    $(window).load(function () {
        $('body').sakura();
    });

    $(document).ready(function() {
    const emotionsByCategory = {
        "기쁨": ["기쁘다", "즐겁다", "감사하다", "행복하다"],
        "설레임": ["수줍다", "부끄럽다", "쑥쓰럽다", "민망하다"],
        "슬픔": ["슬프다", "서럽다", "속상하다", "우울하다"],
        "그리움": ["그립다", "공허하다", "외롭다", "후회스럽다"],
        "불안": ["두렵다", "불안하다", "초조하다", "혼란스럽다"],
        "분노": ["밉다", "실망스럽다", "화나다", "짜증나다"]
    };

    $(".category-btn").click(function() {
        const category = $(this).attr("data-category");
        const emotions = emotionsByCategory[category];
        const container = $("#emotionOptions");
        container.empty(); // 기존의 감정들을 지웁니다.

        emotions.forEach(emotion => {
            const emotionInput = `<label class="inline-flex items-center ml-6">
                                    <input type="radio" class="form-radio" name="emotion" value="${emotion}">
                                    <span class="ml-2">${emotion}</span>
                                    </label>`;
            container.append(emotionInput);
            });
        });
    });
    
    function submitEmotion() {
        var emotion = $('input[name="emotion"]:checked').val(); // 선택된 라디오 버튼 값 가져오기
        if(emotion) { // 선택된 감정이 있을 경우
            generateLine(emotion); // generateLine 함수 호출
        } else {
            // 감정이 선택되지 않았을 경우의 처리, 예: 알림 표시
            alert("감정을 선택해주세요.");
        }
    }

    function generateLine(emotion) {
        $.ajax({
                type: "POST",
                url: "/api/line",
                contentType: "application/json", // 요청의 Content-Type을 application/json으로 명시
                data: JSON.stringify({ 'emotion': emotion }), // 객체를 JSON 문자열로 변환
                success: function (response) {
                    lines = response.lines
                    showLine(lines)
                }
                })
    }

    function showLine(lines) {
        // firstPage를 숨깁니다.
        document.getElementById('firstPage').style.display = 'none';
        document.getElementById('secondPage').style.display = 'block';

        for (let i = 0; i < lines.length; i++) {
            document.getElementById(`line${i+1}`).value = lines[i];
            document.querySelector(`label[for=line${i+1}]`).textContent = lines[i];
        }
        $('input[name="line"]').prop('checked', false);
    }

    function submitLine() {
        var line = $('input[name="line"]:checked').val(); // 선택된 라디오 버튼 값 가져오기
        if(line) { // 선택된 구절이 있을 경우
            generatePoem(line); // generatePoem 함수 호출
        } else {
            // 구절이 선택되지 않았을 경우의 처리
            alert("구절을 선택해주세요.");
        }
    }

    function generatePoem(line) {
        $.ajax({
                type: "POST",
                url: "/api/poem",
                contentType: "application/json", // 요청의 Content-Type을 application/json으로 명시
                data: JSON.stringify({ 'line': line }), // 객체를 JSON 문자열로 변환
                success: function (response) {
                    poem = response.poem
                    showPoem(poem)
                }
                })
    }

    function showPoem(poem) {
        document.getElementById('secondPage').style.display = 'none';
        document.getElementById('thirdPage').style.display = 'block';
        
        var poemContentElement = document.getElementById('poemContent');
        poemContentElement.textContent = poem;
    }

    function showBackPage() {
        document.getElementById('firstPage').style.display = 'block';
        document.getElementById('secondPage').style.display = 'none';
        $('input[name="emotion"]').prop('checked', false);
        $('input[name="line"]').prop('checked', false);
    }
    
    function showMainPage() {
        document.getElementById('firstPage').style.display = 'block';
        document.getElementById('secondPage').style.display = 'none';
        document.getElementById('thirdPage').style.display = 'none';
        $('input[name="emotion"]').prop('checked', false);
        $('input[name="line"]').prop('checked', false);
    }

    function uploadPoem() {
        var instagramID = prompt("인스타 아이디를 입력해 주세요.", "본인의 인스타 아이디");
        
        if(instagramID) {
            $.ajax({
                type: "POST",
                url: "/api/upload",
                contentType: "application/json", // 요청의 Content-Type을 application/json으로 명시
                data: JSON.stringify({ 'instagramID': instagramID }), // 객체를 JSON 문자열로 변환
                success: function (response) {
                    alert("업로드 완료!");
                }
                })
        } else {
            alert("인스타 아이디를 입력하지 않으셨습니다.");
        }

    }
    </script>
</head>
<body class="bg-gray-100">
    <div class="flex justify-center items-center min-h-screen">
        <div class="container mx-auto p-4 max-w-2xl">
            <!-- #1 감정 선택 페이지 -->
            <div id="firstPage" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
                <h1 class="block text-gray-700 text-xl font-bold mb-2">오늘의 기분은?</h1>
                <p class="text-gray-700 mb-4">오늘 하루 어떠셨나요? 오늘의 감정을 선택해 보세요!</p>
                <!-- 카테고리 버튼들 추가 -->
                <div class="mb-4">
                    <button class="category-btn bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded" data-category="기쁨">기쁨</button>
                    <button class="category-btn bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded" data-category="설레임">설레임</button>
                    <button class="category-btn bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded" data-category="슬픔">슬픔</button>
                    <button class="category-btn bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded" data-category="그리움">그리움</button>
                    <button class="category-btn bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded" data-category="불안">불안</button>
                    <button class="category-btn bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded" data-category="분노">분노</button>
                </div>
                <div id="emotionOptions"></div>
                <br>
                <button type="button" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded" onclick="submitEmotion()">선택완료</button>
            </div>

            <!-- #2 구절 선택 페이지 -->
            <div id="secondPage" class="hidden bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
                <h1 class="block text-gray-700 text-xl font-bold mb-2">마음에 드는 구절은?</h1>
                <p class="text-gray-700 mb-4">마음에 드는 문장을 선택하면 해당 구절로 시를 생성해 드려요!</p>
                <div class="mb-4">
                    <div class="flex items-center mb-2">
                        <input id="line1" type="radio" name="line" value="line1" class="form-radio mr-2">
                        <label for="line1" class="text-gray-700">line</label>
                    </div>
                    <div class="flex items-center mb-2">
                        <input id="line2" type="radio" name="line" value="line2" class="form-radio mr-2">
                        <label for="line2" class="text-gray-700">line</label>
                    </div>
                    <div class="flex items-center mb-2">
                        <input id="line3" type="radio" name="line" value="line3" class="form-radio mr-2">
                        <label for="line3" class="text-gray-700">line</label>
                    </div>
                </div> 
                <div class="flex justify-between">
                    <button id="reButton" type="button" class="px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 transition duration-300" onclick="submitEmotion()">다시 생성</button>
                    <div>
                        <button id="submitButton" type="submit" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition duration-300 mr-2" onclick="submitLine()">선택완료</button>
                        <button type="button" class="px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 transition duration-300" onclick="showBackPage()">뒤로가기</button>
                    </div>
                </div>
            </div>

            <!-- #3 시 생성 페이지 -->
            <div id="thirdPage" class="hidden bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
                <h1 class="block text-gray-700 text-xl font-bold mb-2">당신의 오늘과 어울리는 시</h1>
                <br>
                <div class="mb-4">
                    <img src="https://via.placeholder.com/150" alt="이미지" class="rounded mx-auto">
                </div>
                <div>
                    <pre id="poemContent" class="text-gray-700 whitespace-pre-wrap text-center">생성된 시</pre>
                </div>
                <br>
                <div class="flex justify-center gap-4 mb-4">
                    <button id="uploadButton" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded" onclick="uploadPoem()">이미지와 시 공유하기</button>
                    <button class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded" onclick="showMainPage()">메인으로 돌아가기</button>
                </div>
            </div>
        </div>
    </div>  
</body>
</html>